---

# roles/backup-restic/defaults/main.yml

# Paths for restic install
backup_srv_path: "/srv"
backup_restic_path: "{{ backup_srv_path }}/restic"

# Arch map
backup_restic_host_arch_map:
  aarch64: 'arm64'
  armv6l: 'arm'
  armv7l: 'arm'
  i386: '386'
  x86_64: 'amd64'

# Host arch
backup_restic_host_arch: "{{ backup_restic_host_arch_map[ansible_architecture] | default(ansible_architecture) }}"

# Type of host
# This will be used for some types of desktop alerting
backup_restic_desktop_host: false

# Restic version
# valid values: every version available as a release on github
backup_restic_version: "0.13.1"

# Prune host
backup_restic_prune_host: "prune.example.com"

# Hostname used for the backup, restic uses it to access snapshots, etc
# We need to define it here to ensure that the var will also be
# available for the prune host
backup_restic_hostname: "{{ inventory_hostname }}"

# Path for hooks outside of the role
# Can be anything, most likely a relative path like '../../my_shared_templates'
backup_restic_files_hooks_path: ""
backup_restic_templates_hooks_path: ""
# Next after the previous paths
backup_restic_hooks_path: ""

# Sensible defaults
## Alerting
backup_restic_alerting: "{{ backup_restic_alerting_mail_default
                        or backup_restic_alerting_slack_default
                        or backup_restic_alerting_mattermost_default
                        or backup_restic_alerting_telegram_default
                        or backup_restic_alerting_rocketchat_default
                        or backup_restic_alerting_discord_default
                        or backup_restic_alerting_node_default
                        or backup_restic_alerting_libnotify_default
                        }}"
backup_restic_prune_alerting: "{{ backup_restic_prune_alerting_mail_default
                              or backup_restic_prune_alerting_slack_default
                              or backup_restic_prune_alerting_mattermost_default
                              or backup_restic_prune_alerting_telegram_default
                              or backup_restic_prune_alerting_rocketchat_default
                              or backup_restic_prune_alerting_discord_default
                              or backup_restic_prune_alerting_node_default
                              or backup_restic_prune_alerting_libnotify_default
                              }}"

# Enable or disabled alerts when backup is successful
backup_restic_alerting_on_success: true
backup_restic_prune_alerting_on_success: true

backup_restic_alerting_default_body: "Restic default body"
backup_restic_alerting_default_subject: "Restic default subject"

backup_restic_alerting_default_color_fail: "#f52f2f"
backup_restic_alerting_default_color_success: "#71c074"

backup_restic_alerting_default_curl_max_time: "10"
backup_restic_alerting_default_curl_retry: "5"

backup_restic_alerting_default_emoji_fail: '\U0010071'      # :exclamation: in Unicode
backup_restic_alerting_default_emoji_success: '\U0002705'   # :white_check_mark: in Unicode
backup_restic_alerting_default_emote_fail: ":exclamation:"
backup_restic_alerting_default_emote_success: ":white_check_mark:"

### Mail
backup_restic_alerting_mail_default_body: "{{ backup_restic_alerting_default_body }}"
backup_restic_alerting_mail_default_subject: "{{ backup_restic_alerting_default_subject }}"
backup_restic_alerting_mail_from: "restic@example.com"
backup_restic_alerting_mail_tag: "RESTIC"
### Command used to send the mails
### valid values: sendmail, mail
backup_restic_alerting_mail_command: "sendmail"
backup_restic_prune_alerting_mail_command: "{{ backup_restic_alerting_mail_command }}"
### Cronjob env var PATH doesn't include `/usr/sbin` by default
backup_restic_alerting_sendmail_path: "/usr/sbin/sendmail"
backup_restic_prune_alerting_sendmail_path: "{{ backup_restic_alerting_sendmail_path }}"

backup_restic_alerting_mail_default: false
### Comma separated list of recipients
backup_restic_alerting_mail_default_dest: "root@localhost"

backup_restic_prune_alerting_mail_default: false
### Comma separated list of recipients
backup_restic_prune_alerting_mail_default_dest: "{{ backup_restic_alerting_mail_default_dest }}"

### Slack
backup_restic_alerting_slack_color_fail: "{{ backup_restic_alerting_default_color_fail }}"
backup_restic_alerting_slack_color_success: "{{ backup_restic_alerting_default_color_success }}"
backup_restic_alerting_slack_curl_max_time: "{{ backup_restic_alerting_default_curl_max_time }}"
backup_restic_alerting_slack_curl_retry: "{{ backup_restic_alerting_default_curl_retry }}"
backup_restic_alerting_slack_default_body: "{{ backup_restic_alerting_default_body }}"
backup_restic_alerting_slack_default_title: "{{ backup_restic_alerting_default_subject }}"
backup_restic_alerting_slack_emoji_fail: "{{ backup_restic_alerting_default_emote_fail }}"
backup_restic_alerting_slack_emoji_success: "{{ backup_restic_alerting_default_emote_success }}"

backup_restic_alerting_slack_default: false
backup_restic_alerting_slack_default_channel: "alerts-restic"
backup_restic_alerting_slack_default_webhook_url: ""

backup_restic_prune_alerting_slack_default: false
backup_restic_prune_alerting_slack_default_channel: "{{ backup_restic_alerting_slack_default_channel }}"
backup_restic_prune_alerting_slack_default_webhook_url: "{{ backup_restic_alerting_slack_default_webhook_url }}"

### Mattermost
backup_restic_alerting_mattermost_color_fail: "{{ backup_restic_alerting_default_color_fail }}"
backup_restic_alerting_mattermost_color_success: "{{ backup_restic_alerting_default_color_success }}"
backup_restic_alerting_mattermost_curl_max_time: "{{ backup_restic_alerting_default_curl_max_time }}"
backup_restic_alerting_mattermost_curl_retry: "{{ backup_restic_alerting_default_curl_retry }}"
backup_restic_alerting_mattermost_default_body: "{{ backup_restic_alerting_default_body }}"
backup_restic_alerting_mattermost_default_title: "{{ backup_restic_alerting_default_subject }}"
backup_restic_alerting_mattermost_emoji_fail: "{{ backup_restic_alerting_default_emote_fail }}"
backup_restic_alerting_mattermost_emoji_success: "{{ backup_restic_alerting_default_emote_success }}"

backup_restic_alerting_mattermost_default: false
backup_restic_alerting_mattermost_default_channel: "alerts-restic"
backup_restic_alerting_mattermost_default_webhook_url: ""

backup_restic_prune_alerting_mattermost_default: false
backup_restic_prune_alerting_mattermost_default_channel: "{{ backup_restic_alerting_mattermost_default_channel }}"
backup_restic_prune_alerting_mattermost_default_webhook_url: |
  "{{ backup_restic_alerting_mattermost_default_webhook_url }}"

### Healthchecks.io
backup_restic_alerting_healthchecks_io_curl_max_time: "{{ backup_restic_alerting_default_curl_max_time }}"
backup_restic_alerting_healthchecks_io_curl_retry: "{{ backup_restic_alerting_default_curl_retry }}"

### Telegram
backup_restic_alerting_telegram_curl_max_time: "{{ backup_restic_alerting_default_curl_max_time }}"
backup_restic_alerting_telegram_curl_retry: "{{ backup_restic_alerting_default_curl_retry }}"
backup_restic_alerting_telegram_default_msg: "{{ backup_restic_alerting_default_subject }}"
backup_restic_alerting_telegram_emoji_fail: "{{ backup_restic_alerting_default_emoji_fail }}"
backup_restic_alerting_telegram_emoji_success: "{{ backup_restic_alerting_default_emoji_success }}"

backup_restic_alerting_telegram_default: false
backup_restic_alerting_telegram_default_api_key: ""
backup_restic_alerting_telegram_default_chat_id: ""

backup_restic_prune_alerting_telegram_default: false
backup_restic_prune_alerting_telegram_default_api_key: "{{ backup_restic_alerting_telegram_default_api_key }}"
backup_restic_prune_alerting_telegram_default_chat_id: "{{ backup_restic_alerting_telegram_default_chat_id }}"

### Rocket.Chat
backup_restic_alerting_rocketchat_color_fail: "{{ backup_restic_alerting_default_color_fail }}"
backup_restic_alerting_rocketchat_color_success: "{{ backup_restic_alerting_default_color_success }}"
backup_restic_alerting_rocketchat_curl_max_time: "{{ backup_restic_alerting_default_curl_max_time }}"
backup_restic_alerting_rocketchat_curl_retry: "{{ backup_restic_alerting_default_curl_retry }}"
backup_restic_alerting_rocketchat_default_body: "{{ backup_restic_alerting_default_body }}"
backup_restic_alerting_rocketchat_default_title: "{{ backup_restic_alerting_default_subject }}"
backup_restic_alerting_rocketchat_emoji_fail: "{{ backup_restic_alerting_default_emote_fail }}"
backup_restic_alerting_rocketchat_emoji_success: "{{ backup_restic_alerting_default_emote_success }}"

backup_restic_alerting_rocketchat_default: false
backup_restic_alerting_rocketchat_default_webhook_url: ""

backup_restic_prune_alerting_rocketchat_default: false
backup_restic_prune_alerting_rocketchat_default_webhook_url: |
  "{{ backup_restic_alerting_rocketchat_default_webhook_url }}"

### Discord
backup_restic_alerting_discord_color_fail: "16068399"   # #f52f2f as an int
backup_restic_alerting_discord_color_success: "7454836"  # #71c074 as an int
backup_restic_alerting_discord_curl_max_time: "{{ backup_restic_alerting_default_curl_max_time }}"
backup_restic_alerting_discord_curl_retry: "{{ backup_restic_alerting_default_curl_retry }}"
backup_restic_alerting_discord_default_body: "{{ backup_restic_alerting_default_body }}"
backup_restic_alerting_discord_default_title: "{{ backup_restic_alerting_default_subject }}"
backup_restic_alerting_discord_emoji_fail: "{{ backup_restic_alerting_default_emote_fail }}"
backup_restic_alerting_discord_emoji_success: "{{ backup_restic_alerting_default_emote_success }}"

backup_restic_alerting_discord_default: false
backup_restic_alerting_discord_default_webhook_url: ""

backup_restic_prune_alerting_discord_default: false
backup_restic_prune_alerting_discord_default_webhook_url: "{{ backup_restic_alerting_discord_default_webhook_url }}"

### Node Exporter - File Exporter
backup_restic_alerting_node_default: false
backup_restic_alerting_node_default_dir: "/var/lib/node-exporter/file_exporter/"

backup_restic_prune_alerting_node_default: false
backup_restic_prune_alerting_node_default_dir: "{{ backup_restic_alerting_node_default_dir }}"

### Desktop notifications

#### Comma separated list of notification categories
backup_restic_alerting_libnotify_category: "restic"
backup_restic_alerting_libnotify_default_body: "{{ backup_restic_alerting_default_body }}"
backup_restic_alerting_libnotify_default_title: "Restic"
backup_restic_alerting_libnotify_emoji_fail: "{{ backup_restic_alerting_default_emoji_fail }}"
backup_restic_alerting_libnotify_emoji_success: "{{ backup_restic_alerting_default_emoji_success }}"
#### This must be a png
backup_restic_alerting_libnotify_icon_url: "https://github.com/restic/restic/raw/master/doc/logo/logo.png"
backup_restic_alerting_libnotify_timeout_fail: "30000"
backup_restic_alerting_libnotify_timeout_success: "10000"
backup_restic_alerting_libnotify_urgency_fail: "critical"
backup_restic_alerting_libnotify_urgency_success: "normal"

backup_restic_alerting_libnotify_default: false
backup_restic_alerting_libnotify_default_username: ""

backup_restic_prune_alerting_libnotify_default: false
backup_restic_prune_alerting_libnotify_default_username: ""

## Retry
backup_restic_default_max_attempts: 3
backup_restic_default_retry_interval: 600
backup_restic_default_prune_max_attempts: 3
backup_restic_default_prune_retry_interval: 600

## Restic repo integrity checks
### Used to determine how much data is checked after prune and backup.
### valid values:
###   - a number between 0 and 100 (with a '%' at the end) that will be the pourcentage of data to check
###   - a fraction that represent the portion to check (2/5 will check the second data portion)
###   - 'no-data-read' or 'simple' to perform a simple check on the repo (same as 0%)
###   - 'all-data' to perform full check on the repo (same as 100%)
###   - an empty vars mean no check
###
### Some of these values are not available for restic < 12
backup_restic_default_backup_data_integrity_check: "no-data-read"
backup_restic_default_prune_data_integrity_check: "25%"

## Commands
## By default, use the functions defined in restic_wrapper
backup_restic_default_backup_cmd: "cri_backup"
backup_restic_default_prune_cmd: "cri_prune"

## Prune
backup_restic_default_disable_prune: false
backup_restic_default_disable_external_prune: false
backup_restic_default_no_external_prune:
  - "local"
  - "sftp"
  - "rest"
  - "restic_rest"
backup_restic_default_forget_policy: "--keep-daily 7 --keep-weekly 8 --keep-monthly 12 --keep-yearly 2"

## Restore
backup_restic_default_restore_path: "/restore"

## Logrotate
backup_restic_logrotate: true
backup_restic_log_retention_time: 12

## Extra vars
backup_restic_default_extra_vars_export: true
backup_restic_default_extra_vars_prune_export: true

### Vars are being sourced in the retry_handler *and* the backup script
### valid values:
###   {var: my_var, value: my_value, export: true|false(optionnal)}
backup_restic_default_extra_vars: []
backup_restic_default_extra_vars_prune: []

## Cron
backup_restic_default_cron: true
backup_restic_default_cron_minute: '0'
backup_restic_default_cron_hour: '3'
backup_restic_default_cron_day: '*'
backup_restic_default_cron_weekday: '*'
backup_restic_default_cron_month: '*'

backup_restic_default_prune_cron: true
backup_restic_default_prune_cron_minute: '0'
backup_restic_default_prune_cron_hour: '12'
backup_restic_default_prune_cron_day: '*'
backup_restic_default_prune_cron_weekday: '*'
backup_restic_default_prune_cron_month: '*'

# Backends
available_backends:
  - "s3"
  - "aws"
  - "minio"
  - "wasabi"
  - "b2"
  - "backblaze"
  - "azure"
  - "gs"
  - "gcs"
  - "rclone"
  - "rest"
  - "restic_rest"
  - "sftp"
  - "local"
  - "manual"

## s3|aws|minio|wasabi
backup_restic_default_s3_host: "s3.example.com"
backup_restic_default_s3_connection_scheme: "https"
backup_restic_default_s3_port: "443"
# only for aws (optional)
backup_restic_default_aws_region: ""

## b2|backblaze
backup_restic_default_b2_connection_scheme: ""
backup_restic_default_b2_host: ""
backup_restic_default_b2_port: ""

## rest|restic_rest
backup_restic_default_rest_connection_scheme: ""
backup_restic_default_rest_host: ""
backup_restic_default_rest_port: ""

## sftp
## Must be reachable via ssh without password
backup_restic_default_sftp_host: ""
backup_restic_default_sftp_port: ""

# Backups definition
# List of dictionnaries defining the backups
backup_restic_list: []

# This list will allow the user to deploy only a subset of the backups
backup_restic_list_partial: []
